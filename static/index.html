<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EshopBuilder Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app"></div>

    <script>
        const API_URL = window.location.origin + '/api/v1';
        let token = localStorage.getItem('token');
        let currentShop = null;

        function render(component) {
            document.getElementById('app').innerHTML = component;
        }

        function renderLogin() {
            render(`
                <div class="min-h-screen flex items-center justify-center gradient-bg">
                    <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md">
                        <div class="text-center mb-8">
                            <h1 class="text-3xl font-bold text-gray-800">üöÄ EshopBuilder</h1>
                            <p class="text-gray-500 mt-2">Admin Dashboard</p>
                        </div>
                        <div id="error-msg" class="hidden bg-red-100 text-red-700 p-3 rounded-lg mb-4"></div>
                        <input type="email" id="email" placeholder="Email" 
                            class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-purple-500">
                        <input type="password" id="password" placeholder="Heslo" 
                            class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-purple-500">
                        <input type="text" id="name" placeholder="Meno (len pre registr√°ciu)" 
                            class="w-full p-3 border border-gray-300 rounded-lg mb-6 focus:ring-2 focus:ring-purple-500">
                        <button onclick="login()" 
                            class="w-full bg-purple-600 text-white p-3 rounded-lg font-semibold hover:bg-purple-700 transition mb-3">
                            Prihl√°si≈• sa
                        </button>
                        <button onclick="register()" 
                            class="w-full bg-gray-200 text-gray-700 p-3 rounded-lg font-semibold hover:bg-gray-300 transition">
                            Registrova≈• sa
                        </button>
                    </div>
                </div>
            `);
        }

        function renderDashboard(data) {
            const shops = data.shops || [];
            render(`
                <div class="min-h-screen bg-gray-100">
                    <header class="gradient-bg text-white p-4 shadow-lg">
                        <div class="max-w-7xl mx-auto flex justify-between items-center">
                            <h1 class="text-2xl font-bold">üöÄ EshopBuilder</h1>
                            <div class="flex items-center gap-4">
                                <span class="text-purple-200">${localStorage.getItem('email') || 'Admin'}</span>
                                <button onclick="logout()" class="bg-white/20 px-4 py-2 rounded-lg hover:bg-white/30">Odhl√°si≈•</button>
                            </div>
                        </div>
                    </header>
                    <div class="max-w-7xl mx-auto p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-purple-600">${shops.length}</div>
                                <div class="text-gray-500">Shopov</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-green-600" id="total-products">-</div>
                                <div class="text-gray-500">Produktov</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-blue-600" id="total-orders">-</div>
                                <div class="text-gray-500">Objedn√°vok</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-orange-600" id="total-revenue">-</div>
                                <div class="text-gray-500">Tr≈æby (‚Ç¨)</div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                            <h2 class="text-xl font-semibold mb-4">‚ûï Vytvori≈• nov√Ω e-shop</h2>
                            <div class="flex gap-4 flex-wrap">
                                <input type="text" id="shop-name" placeholder="N√°zov e-shopu" 
                                    class="flex-1 min-w-64 p-3 border border-gray-300 rounded-lg">
                                <select id="shop-currency" class="p-3 border border-gray-300 rounded-lg">
                                    <option value="EUR">EUR</option>
                                    <option value="CZK">CZK</option>
                                </select>
                                <button onclick="createShop()" 
                                    class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700">Vytvori≈•</button>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                            <div class="p-6 border-b"><h2 class="text-xl font-semibold">üè™ Moje e-shopy</h2></div>
                            <div class="divide-y">
                                ${shops.length === 0 ? `
                                    <div class="p-12 text-center text-gray-500">
                                        <div class="text-6xl mb-4">üè™</div>
                                        <p>Zatiaƒæ nem√°≈° ≈æiadne e-shopy</p>
                                    </div>
                                ` : shops.map(shop => `
                                    <div class="p-6 hover:bg-gray-50">
                                        <div class="flex justify-between items-center flex-wrap gap-4">
                                            <div>
                                                <h3 class="text-lg font-semibold">${shop.name}</h3>
                                                <p class="text-gray-500 text-sm">/${shop.slug} ‚Ä¢ ${shop.currency}</p>
                                            </div>
                                            <div class="flex gap-2">
                                                <button onclick="openShop('${shop.id}')" 
                                                    class="bg-purple-100 text-purple-700 px-4 py-2 rounded-lg hover:bg-purple-200">Spravova≈•</button>
                                                <button onclick="deleteShop('${shop.id}')" 
                                                    class="bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200">Zmaza≈•</button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        function renderShopDetail(shop, products, orders, stats) {
            render(`
                <div class="min-h-screen bg-gray-100">
                    <header class="gradient-bg text-white p-4">
                        <div class="max-w-7xl mx-auto flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <button onclick="loadDashboard()" class="hover:bg-white/20 p-2 rounded-lg">‚Üê Sp√§≈•</button>
                                <h1 class="text-2xl font-bold">${shop.name}</h1>
                            </div>
                            <button onclick="logout()" class="bg-white/20 px-4 py-2 rounded-lg">Odhl√°si≈•</button>
                        </div>
                    </header>
                    <div class="max-w-7xl mx-auto p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-purple-600">${stats.total_products || 0}</div>
                                <div class="text-gray-500">Produktov</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-green-600">${stats.total_orders || 0}</div>
                                <div class="text-gray-500">Objedn√°vok</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-blue-600">${stats.total_customers || 0}</div>
                                <div class="text-gray-500">Z√°kazn√≠kov</div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <div class="text-3xl font-bold text-orange-600">${(stats.total_revenue || 0).toFixed(2)} ‚Ç¨</div>
                                <div class="text-gray-500">Tr≈æby</div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm mb-6 p-6">
                            <h3 class="font-semibold mb-4">‚ûï Prida≈• produkt</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <input type="text" id="product-name" placeholder="N√°zov produktu" class="p-3 border rounded-lg">
                                <input type="number" id="product-price" placeholder="Cena" step="0.01" class="p-3 border rounded-lg">
                                <input type="number" id="product-quantity" placeholder="Mno≈æstvo" class="p-3 border rounded-lg">
                                <button onclick="createProduct()" 
                                    class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700">Prida≈•</button>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden mb-8">
                            <div class="p-4 border-b bg-gray-50"><h3 class="font-semibold">üì¶ Produkty</h3></div>
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="text-left p-4">Produkt</th>
                                        <th class="text-left p-4">Cena</th>
                                        <th class="text-left p-4">Sklad</th>
                                        <th class="text-right p-4">Akcie</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    ${(products.data || []).length === 0 ? `
                                        <tr><td colspan="4" class="p-8 text-center text-gray-500">≈Ωiadne produkty</td></tr>
                                    ` : (products.data || []).map(p => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="p-4 font-medium">${p.name}</td>
                                            <td class="p-4">${p.price.toFixed(2)} ‚Ç¨</td>
                                            <td class="p-4">${p.quantity}</td>
                                            <td class="p-4 text-right">
                                                <button onclick="deleteProduct('${p.id}')" class="text-red-600 hover:text-red-800">Zmaza≈•</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                            <div class="p-4 border-b bg-gray-50"><h3 class="font-semibold">üõí Objedn√°vky</h3></div>
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="text-left p-4">ƒå√≠slo</th>
                                        <th class="text-left p-4">Z√°kazn√≠k</th>
                                        <th class="text-left p-4">Suma</th>
                                        <th class="text-left p-4">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    ${(orders.orders || []).length === 0 ? `
                                        <tr><td colspan="4" class="p-8 text-center text-gray-500">≈Ωiadne objedn√°vky</td></tr>
                                    ` : (orders.orders || []).map(o => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="p-4 font-medium">${o.order_number}</td>
                                            <td class="p-4">${o.billing_email || '-'}</td>
                                            <td class="p-4">${o.total.toFixed(2)} ‚Ç¨</td>
                                            <td class="p-4"><span class="px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-700">${o.status}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `);
        }

        async function api(endpoint, method = 'GET', body = null) {
            const headers = { 'Content-Type': 'application/json' };
            if (token) headers['Authorization'] = 'Bearer ' + token;
            const options = { method, headers };
            if (body) options.body = JSON.stringify(body);
            const res = await fetch(API_URL + endpoint, options);
            return res.json();
        }

        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const data = await api('/auth/login', 'POST', { email, password });
            if (data.token) {
                token = data.token;
                localStorage.setItem('token', token);
                localStorage.setItem('email', email);
                loadDashboard();
            } else {
                showError(data.error || 'Prihl√°senie zlyhalo');
            }
        }

        async function register() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const name = document.getElementById('name').value;
            const data = await api('/auth/register', 'POST', { email, password, name });
            if (data.token) {
                token = data.token;
                localStorage.setItem('token', token);
                localStorage.setItem('email', email);
                loadDashboard();
            } else {
                showError(data.error || 'Registr√°cia zlyhala');
            }
        }

        function logout() {
            token = null;
            localStorage.removeItem('token');
            localStorage.removeItem('email');
            renderLogin();
        }

        function showError(msg) {
            const el = document.getElementById('error-msg');
            el.textContent = msg;
            el.classList.remove('hidden');
        }

        async function loadDashboard() {
            const data = await api('/shops');
            if (data.error) { logout(); return; }
            currentShop = null;
            renderDashboard(data);
        }

        async function createShop() {
            const name = document.getElementById('shop-name').value;
            const currency = document.getElementById('shop-currency').value;
            if (!name) return alert('Zadaj n√°zov e-shopu');
            await api('/shops', 'POST', { name, currency });
            loadDashboard();
        }

        async function deleteShop(id) {
            if (!confirm('Naozaj chce≈° zmaza≈• tento e-shop?')) return;
            await api('/shops/' + id, 'DELETE');
            loadDashboard();
        }

        async function openShop(id) {
            currentShop = id;
            const [shop, products, orders, stats] = await Promise.all([
                api('/shops/' + id),
                api('/shops/' + id + '/products'),
                api('/shops/' + id + '/orders'),
                api('/shops/' + id + '/stats')
            ]);
            renderShopDetail(shop, products, orders, stats);
        }

        async function createProduct() {
            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const quantity = parseInt(document.getElementById('product-quantity').value) || 0;
            if (!name || !price) return alert('Vypl≈à n√°zov a cenu');
            await api('/shops/' + currentShop + '/products', 'POST', { name, price, quantity });
            openShop(currentShop);
        }

        async function deleteProduct(id) {
            if (!confirm('Zmaza≈• produkt?')) return;
            await api('/shops/' + currentShop + '/products/' + id, 'DELETE');
            openShop(currentShop);
        }

        if (token) { loadDashboard(); } else { renderLogin(); }
    </script>
</body>
</html>
